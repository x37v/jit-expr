# Makefile to build class 'helloworld' for Pure Data.
# Needs Makefile.pdlibbuilder as helper makefile for platform-dependent build
# settings and rules.

CXX = clang++

LLVM_COMPONENTS = support core irreader mcjit linker native

# library name
lib.name = jit_expr
common.sources = src/llvmcodegen/codegen.cc

ifeq ($(UNAME), Linux)
LLVM_CONFIG = llvm-config-5.0
else
LLVM_CONFIG = llvm-config
endif

#convert -I to -isystem so we don't get so many warnings.
LLVMCFLAGS = `${LLVM_CONFIG} --cxxflags | sed 's/-I/-isystem/g'`
cflags = --std=c++11 ${LLVMCFLAGS} -Isrc/ -Isrc/parse/ -Ibuild/src/parse/ -fexceptions -g

ldflags = `${LLVM_CONFIG} --ldflags`
ldflags += `${LLVM_CONFIG} --libs ${LLVM_COMPONENTS}` 
ldlibs += build/src/parse/libparse.a

# input source file (class name == source file basename)
class.sources = src/jit_expr.cpp

# all extra files to be included in binary distribution of the library
datafiles = README.md

# include Makefile.pdlibbuilder from submodule directory 'pd-lib-builder'
PDLIBBUILDER_DIR=pd-lib-builder/
include $(PDLIBBUILDER_DIR)/Makefile.pdlibbuilder

